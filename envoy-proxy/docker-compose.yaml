services:
  envoy:
    image: envoyproxy/envoy:v1.30.1
    container_name: envoy
    volumes:
      - ./envoy/envoy.yaml:/etc/envoy/envoy.yaml:ro
      - ./envoy/cds.yaml:/etc/envoy/cds.yaml:ro   # dynamic cluster tá»« file
    command: envoy -c /etc/envoy/envoy.yaml --service-cluster backend_proxy --service-node node1
    ports:
      - "10000:10000"   # listener HTTP
      - "9901:9901"   # admin
    extra_hosts:
      - "host.docker.internal:host-gateway"
    
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    volumes:
      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
      # - ./prometheus/prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
    ports:
      - "9090:9090"

  grafana:
    image: grafana/grafana-oss:latest
    container_name: grafana
    ports:
      - "3000:3000"
    volumes:
      # - ./grafana/grafana_data:/var/lib/grafana
      - ./grafana/provisioning:/etc/grafana/provisioning
